<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdoptaFurryBuddy - Register</title>
    <link rel="stylesheet" href="common.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
        }

        .container {
            max-width: 2000px;
            margin: 10 auto;
            padding: 5px;
            border-radius: 8px;
            box-sizing: border-box;
        }

        footer {
            background-color: #382e27;
            color: #fff;
            text-align: center;
            padding: 20px 0;
            margin-top: 20px;
            border-radius: 8px;
        }

        footer p {
            margin: 0;
        }

        nav .left-links,
        nav .right-links {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        nav {
            background-color: #382e27;
            padding: 10px 50px;
            text-align: center;
            color: #fff;
            display: flex;
            justify-content: space-between;
        }

        nav a {
            color: #fff;
            text-decoration: none;
            margin: 0 15px;
            font-size: 1.2em;
        }

        .header, .top-section {
            text-align: center;
            margin-bottom: 20px;
            padding: 40px 40px;
            border-radius: 10px;
            background-color: #744f32;
        }

        .container1 {
            color: #fff;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            font-size: 36px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 10px;
        }

        .bottom-section {
            color: hsl(0, 0%, 4%);
            background-color: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .pet-images {
            display: flex;
            justify-content: space-evenly;
            margin-bottom: 20px;
        }

        .pet-image {
            width: 120px;
            height: auto;
        }

        fieldset {
            border: none;
            padding: 0;
            margin: 0;
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="tel"],
        input[type="number"],
        select {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            background-color: #f9f9f9;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
            background-color: #fff;
        }

        button {
            background-color: #744f32;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #a07145;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .login-link {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .login-link a {
            color: #744f32;
            text-decoration: none;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }

        .loading {
            display: none;
        }

        .validation-message {
            font-size: 0.8em;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .validation-message.error {
            color: red;
        }

        .validation-message.success {
            color: green;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .pet-images {
                flex-direction: column;
                align-items: center;
            }
            
            .pet-image {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Register Now!</h1>
        </div>

        <nav>
            <div class="left-links">
                <a href="index.html">Home</a>
                <a href="contact.html">Contact Us</a>
                <a href="shop.html">Shop Items</a>
                <a href="search.html">Search for Pets</a>
                <a href="services.html">Our Services</a>
            </div>
            <div class="right-links">
                <a href="login.html">Login</a>
                <a href="register.html">Register</a>
            </div>
        </nav>

        <main>
            <div class="container1"> 
                <div class="bottom-section">
                    <form id="registrationForm">
                        <div class="pet-images">
                            <img src="data/c.png" alt="Cat" class="pet-image">
                            <span><h2>Register Now</h2></span>
                            <img src="data/d.png" alt="Dog" class="pet-image">
                        </div>
                        
                        <fieldset>
                            <div class="form-grid">
                                <div>
                                    <label for="username">Name: *</label>
                                    <input type="text" id="username" name="username" required placeholder="Enter your name">
                                    <div class="validation-message" id="usernameValidation"></div>
                                </div>
                                
                                <div>
                                    <label for="email">Email: *</label>
                                    <input type="email" id="email" name="email" required placeholder="Enter your Email ID">
                                    <div class="validation-message" id="emailValidation"></div>
                                </div>
                            </div>

                            <label for="password">Password: *</label>
                            <input type="password" id="pass" name="pass" required placeholder="Enter password (min 6 characters)" autocomplete="new-password">
                            <div class="validation-message" id="passwordValidation"></div>
                            
                            <label for="adr">Address: *</label>
                            <input type="text" id="adr" name="adr" required placeholder="Enter your address">
                            
                            <div class="form-grid">
                                <div>
                                    <label for="pincode">Pincode: *</label>
                                    <input type="text" id="pincode" name="pincode" required placeholder="Enter your pincode" pattern="[0-9]{6}">
                                    <div class="validation-message" id="pincodeValidation"></div>
                                </div>
                                
                                <div>
                                    <label for="phone">Phone Number: *</label>
                                    <input type="tel" id="phone" name="phone" required placeholder="Enter your phone number">
                                    <div class="validation-message" id="phoneValidation"></div>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div>
                                    <label for="pets_owned">Number of Pets Owned:</label>
                                    <input type="number" id="pets_owned" name="petsOwned" min="0" value="0">
                                </div>
                                
                                <div>
                                    <label for="preferred_species">Preferred Pet Species:</label>
                                    <select id="preferred_species" name="preferredSpecies">
                                        <option value="dog">Dog</option>
                                        <option value="cat">Cat</option>
                                        <option value="bird">Bird</option>
                                        <option value="rabbit">Rabbit</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="error-message" id="errorMessage"></div>
                            <div class="success-message" id="successMessage"></div>
                            
                            <button id="registerButton" type="submit">
                                <span class="normal">Register</span>
                                <span class="loading">Registering...</span>
                            </button>
                        </fieldset>

                        <p class="login-link">Already have an account? <a href="login.html">Login</a></p>
                    </form>
                </div>
            </div>
        </main>

        <!-- Configuration -->
        <script>
            // API Configuration
            const API_BASE_URL = 'http://localhost:8080/api';
            // For production: const API_BASE_URL = 'https://your-render-app.onrender.com/api';
        </script>

        <!-- Auth Script -->
        <script src="js/auth.js"></script>

        <script>
            // Form validation
            const validationRules = {
                username: {
                    minLength: 3,
                    maxLength: 50,
                    pattern: /^[a-zA-Z\s]+$/
                },
                email: {
                    pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/
                },
                password: {
                    minLength: 6,
                    pattern: /^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{6,}$/
                },
                pincode: {
                    pattern: /^[0-9]{6}$/
                },
                phone: {
                    pattern: /^[0-9]{10}$/
                }
            };

            // Validation functions
            function validateField(fieldName, value) {
                const rules = validationRules[fieldName];
                if (!rules) return { valid: true };

                const result = { valid: true, message: '' };

                if (rules.minLength && value.length < rules.minLength) {
                    result.valid = false;
                    result.message = `Minimum ${rules.minLength} characters required`;
                }

                if (rules.maxLength && value.length > rules.maxLength) {
                    result.valid = false;
                    result.message = `Maximum ${rules.maxLength} characters allowed`;
                }

                if (rules.pattern && !rules.pattern.test(value)) {
                    result.valid = false;
                    switch (fieldName) {
                        case 'username':
                            result.message = 'Only letters and spaces allowed';
                            break;
                        case 'email':
                            result.message = 'Please enter a valid email address';
                            break;
                        case 'password':
                            result.message = 'Password must contain at least one number and one special character';
                            break;
                        case 'pincode':
                            result.message = 'Pincode must be 6 digits';
                            break;
                        case 'phone':
                            result.message = 'Phone number must be 10 digits';
                            break;
                    }
                }

                return result;
            }

            function showValidation(fieldName, result) {
                const validationDiv = document.getElementById(`${fieldName}Validation`);
                if (!validationDiv) return;

                validationDiv.textContent = result.message;
                validationDiv.className = `validation-message ${result.valid ? 'success' : 'error'}`;

                // Update input border color
                const input = document.getElementById(fieldName === 'password' ? 'pass' : fieldName);
                if (input) {
                    input.style.borderColor = result.valid ? '#4CAF50' : '#dc3545';
                }
            }

            // Add event listeners for real-time validation
            document.addEventListener('DOMContentLoaded', function() {
                // Check if user is already logged in
                if (isLoggedIn()) {
                    window.location.href = 'index.html';
                    return;
                }

                // Username validation
                const usernameInput = document.getElementById('username');
                usernameInput.addEventListener('input', function(e) {
                    const result = validateField('username', e.target.value);
                    showValidation('username', result);
                });

                // Email validation
                const emailInput = document.getElementById('email');
                emailInput.addEventListener('input', function(e) {
                    const result = validateField('email', e.target.value);
                    showValidation('email', result);
                });

                // Password validation
                const passwordInput = document.getElementById('pass');
                passwordInput.addEventListener('input', function(e) {
                    const result = validateField('password', e.target.value);
                    showValidation('password', result);
                });

                // Pincode validation
                const pincodeInput = document.getElementById('pincode');
                pincodeInput.addEventListener('input', function(e) {
                    // Only allow numbers
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                    const result = validateField('pincode', e.target.value);
                    showValidation('pincode', result);
                });

                // Phone validation
                const phoneInput = document.getElementById('phone');
                phoneInput.addEventListener('input', function(e) {
                    // Only allow numbers
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                    const result = validateField('phone', e.target.value);
                    showValidation('phone', result);
                });

                // Form submission
                document.getElementById('registrationForm').addEventListener('submit', handleRegistration);
            });

            async function handleRegistration(event) {
                event.preventDefault();
                
                const registerButton = document.getElementById('registerButton');
                const errorDiv = document.getElementById('errorMessage');
                const successDiv = document.getElementById('successMessage');
                const normalSpan = registerButton.querySelector('.normal');
                const loadingSpan = registerButton.querySelector('.loading');
                
                // Clear previous messages
                errorDiv.style.display = 'none';
                successDiv.style.display = 'none';
                
                // Get form data
                const formData = new FormData(event.target);
                const userData = {
                    username: formData.get('username').trim(),
                    email: formData.get('email').trim(),
                    pass: formData.get('pass'),
                    adr: formData.get('adr').trim(),
                    pincode: formData.get('pincode').trim(),
                    phone: parseInt(formData.get('phone')),
                    petsOwned: parseInt(formData.get('petsOwned')) || 0,
                    preferredSpecies: formData.get('preferredSpecies')
                };

                // Validate all fields
                let isValid = true;
                const fieldsToValidate = ['username', 'email', 'password', 'pincode', 'phone'];
                
                for (const field of fieldsToValidate) {
                    const value = field === 'password' ? userData.pass : userData[field];
                    const result = validateField(field, value?.toString() || '');
                    showValidation(field, result);
                    if (!result.valid) isValid = false;
                }

                if (!isValid) {
                    errorDiv.textContent = 'Please fix the validation errors above.';
                    errorDiv.style.display = 'block';
                    return;
                }

                // Show loading state
                registerButton.disabled = true;
                normalSpan.style.display = 'none';
                loadingSpan.style.display = 'inline';

                try {
                    if (authService) {
                        // Use API
                        const response = await authService.register(userData);
                        successDiv.textContent = 'Registration successful! Redirecting to login...';
                        successDiv.style.display = 'block';
                        
                        // Reset form
                        event.target.reset();
                        
                        // Redirect to login after 2 seconds
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else {
                        // Fallback for when backend is not available
                        console.warn('Backend not available, using fallback registration');
                        
                        // Store user data locally (demo mode)
                        const users = JSON.parse(localStorage.getItem('users') || '[]');
                        
                        // Check if user already exists
                        if (users.find(u => u.email === userData.email || u.username === userData.username)) {
                            throw new Error('User with this email or username already exists');
                        }
                        
                        // Add new user
                        userData.id = Date.now();
                        users.push(userData);
                        localStorage.setItem('users', JSON.stringify(users));
                        
                        successDiv.textContent = 'Registration successful! (Demo mode) Redirecting to login...';
                        successDiv.style.display = 'block';
                        
                        // Reset form
                        event.target.reset();
                        
                        // Redirect to login after 2 seconds
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    }
                } catch (error) {
                    errorDiv.textContent = error.message || 'Registration failed. Please try again.';
                    errorDiv.style.display = 'block';
                } finally {
                    // Reset loading state
                    registerButton.disabled = false;
                    normalSpan.style.display = 'inline';
                    loadingSpan.style.display = 'none';
                }
            }
        </script>

        <footer>
            <p>Contact Us: contact@adoptafurrybuddy.com</p>
        </footer>
    </div>
</body>
</html>